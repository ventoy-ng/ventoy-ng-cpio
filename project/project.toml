name = "ventoy-cpio"

[[components]]
name = "busybox-ash"
target_set = "system"
sources = ["busybox"]
build_file = "components/busybox/build.py"

[[components]]
name = "busybox-full"
target_set = "system"
sources = ["busybox"]
build_file = "components/busybox/build.py"

[[components]]
name = "busybox-hexdump"
target_set = "system"
sources = ["busybox"]
build_file = "components/busybox/build.py"

[[components]]
name = "busybox-xzcat"
target_set = "system"
sources = ["busybox"]
build_file = "components/busybox/build.py"

[[components]]
name = "device-mapper"
target_set = "system"
sources = ["device-mapper"]

[[components]]
name = "lunzip"
target_set = "system"
sources = ["lunzip"]

[[components]]
name = "lz4"
target_set = "system"
sources = ["lz4"]

[[components]]
name = "lzo"
target_set = "system"
sources = ["lzo"]

[[components]]
name = "smallz4"
target_set = "system"
sources = ["smallz4"]

[[components]]
name = "vblade"
target_set = "system"
sources = ["vblade"]

[[components]]
name = "xz"
target_set = "system"
sources = ["xz"]

[[components]]
name = "xz-embedded"
target_set = "system"
sources = ["xz-embedded"]

[[components]]
name = "zlib"
target_set = "system"
sources = ["zlib"]

[[components]]
name = "zstd"
target_set = "system"
sources = ["zstd"]

[[components]]
name = "squashfs"
target_set = "system"
sources = ["squashfs"]
deps = ["lz4", "lzo", "xz", "zlib", "zstd"]

[[components]]
name = "rd-stage2-tools"
target_set = "system"
deps = [
    "busybox-full",
    "device-mapper",
    "lunzip",
    "smallz4",
    "squashfs",
    "vblade",
    "zlib",
    "zstd",
]

[[components]]
name = "rd-stage2"
target_set = "output"
deps = ["rd-stage2-tools"]
build_file = "components/cpio/build.py"
build_args.cpio_dir = "."
build_args.cpio_files = "tool"
build_args.cpio_target = "tool.cpio.xz"

[[components]]
name = "rd-stage1-tools"
target_set = "system"
deps = ["busybox-ash", "busybox-xzcat", "xz-embedded"]

[[components]]
name = "arch-ramdisks"
target_set = "output"
deps = ["rd-stage2", "rd-stage1-tools"]
build_file = "components/cpio/build.py"
build_args.cpio_dir = "ramdisk"
build_args.cpio_files = "."
build_args.cpio_target = "ventoy_{target}.cpio"

[[components]]
name = "base"

[[components]]
name = "main"
deps = ["base", "arch-ramdisks"]
